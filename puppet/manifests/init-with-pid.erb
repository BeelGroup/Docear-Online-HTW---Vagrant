#!/bin/sh

### BEGIN INIT INFO
# Provides:          <%= @name %>
# Required-Start:    $local_fs $remote_fs
# Required-Stop:     $local_fs $remote_fs
# Should-Start:      $network
# Should-Stop:       $network
# Default-Start:     2 3 4 5
# Default-Stop:      0 1 6
# Short-Description: Daemonized version of <%= @name %>.
# Description:       
### END INIT INFO

# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # 
# # # # #   M A I N  C U S T O M I S A T I O N   S E C T I O N  # # # # # 
# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # 

APPLICATION_PATH="<%= @application_path %>"
APPLICATION_NAME="<%= @name %>"
PARAMS="<%= @start_script_params %>"
JAVA_HOME=/usr/lib/jvm/java-6-openjdk
export JAVA_HOME
USER=<%= @user %>
GROUP=<%= @group %>
PIDFILE="<%= @pid_file %>"
START_CMD="<%= @start_command %>"

# source function library
# -> comented out for ubuntu . /etc/init.d/functions
RETVAL=0

#you can't start directly in folder with start script
cd ${APPLICATION_PATH}/../

start() {
        start-stop-daemon --start -p "${PIDFILE}" --background --chuid ${USER}:${GROUP} --exec /bin/bash -- ${START_CMD}
        RETVAL=$?
        if [ $RETVAL -eq 0 ]; then
                echo "starting ${APPLICATION_NAME} - Success"
        else
                echo "starting ${APPLICATION_NAME} - Failure"
        fi
        echo
}
stop() {
        kill -9 `cat ${PIDFILE}`
        RETVAL=$?
        rm -rf ${PIDFILE}

        if [ $RETVAL -eq 0 ]; then
                echo "Stopping Application: ${APPLICATION_NAME} - Success"
        else
                echo "Stopping Application: ${APPLICATION_NAME} - Failure"
        fi
        echo
}
clean() {
        rm -f ${PIDFILE}
}
case "$1" in
        start)
        clean
        start
        ;;
        stop)
        stop
        ;;
        restart|reload)
        stop
        sleep 10
        start
        ;;
        status)
        status
        ;;
        *)
        echo "Usage: $0 {start|stop|restart}"
esac
exit 0